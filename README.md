# 🤖 ربات تلگرام ارسال پیام گروهی

## 📋 معرفی پروژه

این پروژه یک **ربات تلگرام** است که با زبان **Java** نوشته شده و قابلیت‌های زیر را دارد:

1. **خواندن لیست کاربران از فایل اکسل** (Excel)
2. **ارسال پیام شخصی‌سازی شده** به هر کاربر
3. **ارسال عکس‌های دسته‌ای** از یک پوشه
4. **دریافت دستورات** از کاربران و پاسخ‌دهی
5. **ثبت خودکار کاربران جدید** در فایل اکسل هنگام اولین `/start`

---

## 🚀 اجرای سریع (TL;DR)

1. **پیش‌نیازها**: JDK 21، پر کردن `user2.xlsx`, گذاشتن عکس‌های شماره‌گذاری شده در `fol/`, قرار دادن کتابخانه‌ها در `lib/` و تنظیم `botToken` داخل `src/Main.java`.
2. **کامپایل**:
    ```powershell
    javac -cp "lib/*" -d bin src/*.java
    ```
3. **اجرا**:
    ```powershell
    java -cp "bin;lib/*" Main
    ```

---

## 🏗️ ساختار پروژه

```
java_bot/
├── src/                   ← تمام فایل‌های سورس جاوا (Main.java و ...)
├── bin/                   ← خروجی کامپایل (فایل‌های .class)
├── lib/                   ← کتابخانه‌های مورد نیاز (JAR files)
├── fol/                   ← پوشه عکس‌ها (1.jpg, 2.jpg, ...)
└── user2.xlsx             ← فایل اکسل حاوی لیست کاربران
```

---

## 📁 توضیح فایل‌ها

### 1. `Main.java` - کلاس اصلی

این فایل **نقطه شروع** برنامه است و شامل:

| متد | توضیح |
|-----|-------|
| `main()` | شروع برنامه، جمع‌آوری کاربران و شروع polling |
| `collectAllChatIds()` | جمع‌آوری chat_id کاربرانی که قبلاً پیام داده‌اند |
| `notifyBotOnline()` | ارسال پیام "ربات آنلاین شد" به همه کاربران |
| `startPolling()` | حلقه اصلی برای دریافت پیام‌های جدید (Long Polling) |
| `handleCommand()` | پردازش دستورات `/start`, `/send`, `/status` |
| `sendToExcelUsers()` | ارسال پیام و عکس به کاربران لیست اکسل |
| `getChatIdByUsername()` | پیدا کردن chat_id بر اساس username |

**مفهوم Polling:**
```
┌─────────────────────────────────────────────────────────┐
│  برنامه هر 30 ثانیه از تلگرام می‌پرسد:                   │
│  "پیام جدیدی هست؟"                                      │
│                                                          │
│  اگر پیام بود ──► پردازش می‌کند                          │
│  اگر نبود ──► دوباره می‌پرسد                             │
└─────────────────────────────────────────────────────────┘
```

### 2. `MessagePhotoSender.java` - ارسال پیام و عکس

این فایل با **Telegram Bot API** ارتباط برقرار می‌کند:

| متد | توضیح |
|-----|-------|
| `sendMessage()` | ارسال پیام متنی با POST request |
| `sendPhoto()` | ارسال یک عکس با multipart/form-data |
| `sendKPhotos()` | ارسال k عکس از ایندکس start |

**نحوه ارسال عکس (Multipart):**
```
POST https://api.telegram.org/bot<TOKEN>/sendPhoto

┌────────────────────────────────────┐
│ Content-Type: multipart/form-data │
├────────────────────────────────────┤
│ chat_id: 123456789                │
│ photo: [binary data of image]     │
└────────────────────────────────────┘
```

### 3. `ExcelReader.java` - خواندن اکسل

از کتابخانه **Apache POI** برای خواندن فایل `.xlsx` استفاده می‌کند:

```
┌─────────────────────────────────────┐
│  user2.xlsx                         │
├──────────┬────────┬─────────────────┤
│ username │ gender │ lastname        │
├──────────┼────────┼─────────────────┤
│ ali_123  │ Mr.    │ Ahmadi          │
│ sara_456 │ Ms.    │ Hosseini        │
└──────────┴────────┴─────────────────┘
         ↓
    List<User> users
```

### 4. `User.java` - مدل کاربر

یک **POJO** (Plain Old Java Object) ساده:

```java
public class User {
    String username;   // نام کاربری تلگرام
    String gender;     // Mr. یا Ms.
    String lastname;   // نام خانوادگی
    Long chatId;       // شناسه چت
}
```

---

## 🔧 پیش‌نیازها

1. **JDK 21** یا بالاتر
2. **کتابخانه‌های JAR:**
   - `json-20230227.jar` - پردازش JSON
   - `poi-5.2.3.jar` - خواندن اکسل
   - `poi-ooxml-5.2.3.jar` - پشتیبانی xlsx
   - (و وابستگی‌های POI)

---

## 🚀 نحوه اجرا

### مرحله 1: دانلود کتابخانه‌ها

کتابخانه‌های زیر را دانلود کرده و در پوشه `lib/` قرار دهید:

```
lib/
├── json-20230227.jar
├── poi-5.2.3.jar
├── poi-ooxml-5.2.3.jar
├── poi-ooxml-lite-5.2.3.jar
├── xmlbeans-5.1.1.jar
├── commons-collections4-4.4.jar
├── commons-io-2.11.0.jar
├── commons-compress-1.21.jar
└── log4j-api-2.20.0.jar
```

### مرحله 2: تنظیم توکن ربات

1. به [@BotFather](https://t.me/BotFather) در تلگرام پیام دهید
2. دستور `/newbot` را بزنید و یک ربات بسازید
3. توکن دریافتی را در `Main.java` قرار دهید:

```java
static String botToken = "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz";
```

### مرحله 3: آماده‌سازی فایل اکسل

فایل `user2.xlsx` را با این ستون‌ها بسازید (ستون `chat_id` به صورت خودکار توسط برنامه پر می‌شود):

| username | gender | lastname | chat_id |
|----------|--------|----------|---------|
| user1    | Mr.    | Ahmadi   |         |
| user2    | Ms.    | Rezaei   |         |

> هر کاربری که دستور `/start` را بفرستد، اگر در فایل وجود نداشته باشد به صورت خودکار به انتهای فایل اضافه می‌شود و `chat_id` او ذخیره می‌گردد.

### مرحله 4: قرار دادن عکس‌ها

عکس‌ها را در پوشه `fol/` با نام عددی قرار دهید:
```
fol/
├── 1.jpg
├── 2.jpg
├── 3.jpg
...
```

### مرحله 5: کامپایل و اجرا

```bash
# کامپایل (فایل‌های src -> bin)
javac -cp "lib/*" -d bin src/*.java

# اجرا (bin + کتابخانه‌ها)
java -cp "bin;lib/*" Main
```

در **PowerShell** نیز همین دستورات قابل اجرا هستند.

---

## 📱 دستورات ربات

| دستور | عملکرد |
|--------|--------|
| `/start` | نمایش پیام خوش‌آمدگویی و راهنما |
| `/send` | ارسال پیام و عکس به کاربران لیست اکسل |
| `/status` | نمایش تعداد کاربران شناخته شده |

---

## 🔄 فلوچارت عملکرد

```
         شروع برنامه
              │
              ▼
    ┌─────────────────────┐
    │ جمع‌آوری chat_id ها │
    └─────────────────────┘
              │
              ▼
    ┌─────────────────────┐
    │ ارسال "آنلاین شدم"  │
    └─────────────────────┘
              │
              ▼
    ┌─────────────────────┐
    │   شروع Polling      │◄─────────────┐
    └─────────────────────┘              │
              │                          │
              ▼                          │
        پیام جدید؟ ──── نه ─────────────┘
              │
             بله
              │
              ▼
    ┌─────────────────────┐
    │  پردازش دستور       │
    │  /start /send ...   │
    └─────────────────────┘
              │
              └──────────────────────────┘
```

---

## ⚠️ نکات مهم

1. **کاربران باید ابتدا به ربات پیام دهند** تا chat_id آن‌ها ذخیره شود
2. **توکن ربات را محرمانه نگه دارید** و در گیت commit نکنید
3. **تلگرام محدودیت ارسال دارد** - ارسال بیش از حد پیام ممکن است بلاک شوید
4. **عکس‌ها باید با عدد نام‌گذاری شوند** مثل `1.jpg`, `2.jpg`

---

## 🛠️ تکنولوژی‌های استفاده شده

| تکنولوژی | کاربرد |
|----------|--------|
| Java 21 | زبان برنامه‌نویسی |
| Telegram Bot API | ارتباط با تلگرام |
| Apache POI | خواندن فایل اکسل |
| org.json | پردازش پاسخ JSON |
| HttpURLConnection | ارسال HTTP Request |

---

## 👨‍💻 نویسنده

پروژه دانشگاهی - درس برنامه‌نویسی پیشرفته Java

---

## 📚 منابع

- [Telegram Bot API Documentation](https://core.telegram.org/bots/api)
- [Apache POI Documentation](https://poi.apache.org/)
- [Java HttpURLConnection](https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/net/HttpURLConnection.html)
